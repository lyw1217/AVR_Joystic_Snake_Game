/*
 * doxmatrix.c
 *
 * Created: 2019-07-25 오후 2:38:04
 *  Author: LYW
 */ 

#include "dotmatrix.h"

uint8_t txt_dead[] = {
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	// 공백
	0x00,0xFF,0xFF,0xC3,0xC3,0x7E,0x3C,0x00,	// D
	0x00,0xFF,0xFF,0xDB,0xDB,0xDB,0xC3,0x00,	// E
	0x00,0xF8,0xFE,0x1B,0x1B,0xFE,0xF8,0x00,	// A
	0x00,0xFF,0xFF,0xC3,0xC3,0x7E,0x3C,0x00,	// D
	0x00,0x42,0x24,0x18,0x42,0x24,0x18,0x00,	// >>
	0x5C,0x54,0x74,0x00,0x7C,0x44,0x44,0x00,	// sc
	0x7C,0x44,0x7C,0x00,0x7C,0x08,0x04,0x00,	// or
	0x7C,0x54,0x5C,0x00,0x00,0x00,0x00,0x28,	// e:
	0x00
};

uint8_t txt_play[] = {
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	// 공백
	0x00,0x7E,0x0A,0x0E,0x00,0x7E,0x40,0x40,	// PL
	0x00,0x7C,0x0A,0x7C,0x00,0x0E,0x70,0x0E,	// AY
};

uint8_t txt_num[] = {
	0x00,0x00,0x44,0x44,0x7E,0x40,0x00,0x00,	// 1
	0x00,0x00,0x62,0x52,0x4A,0x4C,0x00,0x00,	// 2
	0x00,0x00,0x4A,0x4A,0x4A,0x36,0x00,0x00,	// 3
};

uint8_t txt_success[] = {
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	// 공백
	0x00,0x4E,0x4A,0x7A,0x00,0x7E,0x40,0x7E,	// SU
	0x00,0x7E,0x42,0x42,0x00,0x7E,0x42,0x42,	// CC
	0x00,0x7E,0x4A,0x4A,0x00,0x4E,0x4A,0x7A,	// ES
	0x00,0x4E,0x4A,0x7A,0x00,0x00,0x5E,0x00		// S!
};

uint8_t txt_welcome[] = {
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	// 공백
	0x00,0x4E,0x4A,0x7A,0x00,0x78,0x08,0x78,	// sn
	0x00,0x78,0x28,0x78,0x00,0x78,0x30,0x48,	// ak
	0x00,0x78,0x58,0x58,0x00,0x00,0x00,0x00		// e
};

uint8_t txt_score[] = {
	0x00,0x7C,0x44,0x7C,0x00,0x7C,0x44,0x7C,	// 0
	0x00,0x7C,0x44,0x7C,0x00,0x00,0x04,0x7C,	// 1
	0x00,0x7C,0x44,0x7C,0x00,0x74,0x54,0x5C,	// 2
	0x00,0x7C,0x44,0x7C,0x00,0x54,0x54,0x7C,	// 3
	0x00,0x7C,0x44,0x7C,0x00,0x1C,0x10,0x7C,	// 4
	0x00,0x7C,0x44,0x7C,0x00,0x5C,0x54,0x74,	// 5
	0x00,0x7C,0x44,0x7C,0x00,0x7C,0x50,0x70,	// 6
	0x00,0x7C,0x44,0x7C,0x00,0x1C,0x04,0x7C,	// 7
	0x00,0x7C,0x44,0x7C,0x00,0x7C,0x54,0x7C,	// 8
	0x00,0x7C,0x44,0x7C,0x00,0x1C,0x14,0x7C,	// 9
	0x00,0x00,0x04,0x7C,0x00,0x7C,0x44,0x7C,	// 10
	0x00,0x00,0x04,0x7C,0x00,0x00,0x04,0x7C,	// 11
	0x00,0x00,0x04,0x7C,0x00,0x74,0x54,0x5C,	// 12
	0x00,0x00,0x04,0x7C,0x00,0x54,0x54,0x7C,	// 13
	0x00,0x00,0x04,0x7C,0x00,0x1C,0x10,0x7C,	// 14
	0x00,0x00,0x04,0x7C,0x00,0x5C,0x54,0x74,	// 15
	0x00,0x00,0x04,0x7C,0x00,0x7C,0x50,0x70,	// 16
	0x00,0x00,0x04,0x7C,0x00,0x1C,0x04,0x7C,	// 17
	0x00,0x00,0x04,0x7C,0x00,0x7C,0x54,0x7C,	// 18
	0x00,0x00,0x04,0x7C,0x00,0x1C,0x14,0x7C,	// 19
	0x00,0x74,0x54,0x5C,0x00,0x7C,0x44,0x7C,	// 20
	0x00,0x74,0x54,0x5C,0x00,0x00,0x04,0x7C,	// 21
	0x00,0x74,0x54,0x5C,0x00,0x74,0x54,0x5C,	// 22
	0x00,0x74,0x54,0x5C,0x00,0x54,0x54,0x7C,	// 23
	0x00,0x74,0x54,0x5C,0x00,0x1C,0x10,0x7C,	// 24
	0x00,0x74,0x54,0x5C,0x00,0x5C,0x54,0x74,	// 25
	0x00,0x74,0x54,0x5C,0x00,0x7C,0x50,0x70,	// 26
	0x00,0x74,0x54,0x5C,0x00,0x0C,0x04,0x7C,	// 27
	0x00,0x74,0x54,0x5C,0x00,0x7C,0x54,0x7C,	// 28
	0x00,0x74,0x54,0x5C,0x00,0x1C,0x14,0x7C,	// 29
	0x00,0x54,0x54,0x7C,0x00,0x7C,0x44,0x7C,	// 30
	0x00,0x54,0x54,0x7C,0x00,0x00,0x04,0x7C,	// 31
	0x00,0x54,0x54,0x7C,0x00,0x74,0x54,0x5C,	// 32
	0x00,0x54,0x54,0x7C,0x00,0x54,0x54,0x7C,	// 33
	0x00,0x54,0x54,0x7C,0x00,0x1C,0x10,0x7C,	// 34
	0x00,0x54,0x54,0x7C,0x00,0x5C,0x54,0x74,	// 35
	0x00,0x54,0x54,0x7C,0x00,0x7C,0x50,0x70,	// 36
	0x00,0x54,0x54,0x7C,0x00,0x0C,0x04,0x7C,	// 37
	0x00,0x54,0x54,0x7C,0x00,0x7C,0x54,0x7C,	// 38
	0x00,0x54,0x54,0x7C,0x00,0x1C,0x14,0x7C,	// 39
	0x00,0x1C,0x10,0x7C,0x00,0x7C,0x44,0x7C,	// 40
	0x00,0x1C,0x10,0x7C,0x00,0x00,0x04,0x7C,	// 41
	0x00,0x1C,0x10,0x7C,0x00,0x74,0x54,0x5C,	// 42
	0x00,0x1C,0x10,0x7C,0x00,0x54,0x54,0x7C,	// 43
	0x00,0x1C,0x10,0x7C,0x00,0x1C,0x10,0x7C,	// 44
	0x00,0x1C,0x10,0x7C,0x00,0x5C,0x54,0x74,	// 45
	0x00,0x1C,0x10,0x7C,0x00,0x7C,0x50,0x70,	// 46
	0x00,0x1C,0x10,0x7C,0x00,0x0C,0x04,0x7C,	// 47
	0x00,0x1C,0x10,0x7C,0x00,0x7C,0x54,0x7C,	// 48
	0x00,0x1C,0x10,0x7C,0x00,0x1C,0x14,0x7C,	// 49
	0x00,0x5C,0x54,0x74,0x00,0x7C,0x44,0x7C,	// 50
	0x00,0x5C,0x54,0x74,0x00,0x00,0x04,0x7C,	// 51
	0x00,0x5C,0x54,0x74,0x00,0x74,0x54,0x5C,	// 52
	0x00,0x5C,0x54,0x74,0x00,0x54,0x54,0x7C,	// 53
	0x00,0x5C,0x54,0x74,0x00,0x1C,0x10,0x7C,	// 54
	0x00,0x5C,0x54,0x74,0x00,0x5C,0x54,0x74,	// 55
	0x00,0x5C,0x54,0x74,0x00,0x7C,0x50,0x70,	// 56
	0x00,0x5C,0x54,0x74,0x00,0x0C,0x04,0x7C,	// 57
	0x00,0x5C,0x54,0x74,0x00,0x7C,0x54,0x7C,	// 58
	0x00,0x5C,0x54,0x74,0x00,0x1C,0x14,0x7C,	// 59
	0x00,0x7C,0x50,0x70,0x00,0x7C,0x44,0x7C,	// 60
	0x00,0x7C,0x50,0x70,0x00,0x00,0x04,0x7C,	// 61
	0x00,0x7C,0x50,0x70,0x00,0x74,0x54,0x5C,	// 62
	0x00,0x7C,0x50,0x70,0x00,0x54,0x54,0x7C	// 63
};

uint8_t txt_welcomesize = sizeof(txt_welcome);
uint8_t txt_deadsize = sizeof(txt_dead);
uint8_t txt_playsize = sizeof(txt_play);
uint8_t txt_numsize = sizeof(txt_num);
uint8_t txt_successsize = sizeof(txt_success);
uint8_t txt_scoresize = sizeof(txt_score);
/* 위처럼 extern으로 선언해도 되고 아래처럼 함수로 반환해도 된다.
uint8_t get_arr_size(){
	printf("%d",(sizeof(txt_dead)/sizeof(txt_dead[0])));
	return (sizeof(txt_dead)/sizeof(txt_dead[0]));
}
*/

void ShiftClock(void)
{
	set_bit(SHIFT_CLOCK);
	clear_bit(SHIFT_CLOCK);
}
void LatchClock(void)
{
	set_bit(LATCH_CLOCK);
	clear_bit(LATCH_CLOCK);
}
void ByteDataWrite(uint8_t data)
{
	for(uint8_t i = 0; i < 8; i++){
		if(data & 0b10000000)
		set_bit(DATA);
		else
		clear_bit(DATA);

		ShiftClock();
		data = data << 1;
	}

	LatchClock();
}

void dotMatrix_Init()
{
	REGISTER_DDR |= _BV(SHIFT_CLOCK) | _BV(LATCH_CLOCK) | _BV(DATA);
}

void slide_Data_Welcome(int pattern_index){
	for(int i = 0; i < 8; i++){
		uint8_t col_data = ~(1 << i);
		
		ByteDataWrite(col_data);
		ByteDataWrite(txt_welcome[(pattern_index + i) % (txt_welcomesize)]);

		_delay_us(500);
	}
	ByteDataWrite(0);
}

void slide_Data_Dead(int pattern_index){
	for(int i = 0; i < 8; i++){
		uint8_t col_data = ~(1 << i);
		
		ByteDataWrite(col_data);
		ByteDataWrite(txt_dead[(pattern_index + i) % (txt_deadsize)]);

		_delay_us(500);
	}
	ByteDataWrite(0);
}

void slide_Data_Play(int pattern_index){
	for(int i = 0; i < 8; i++){
		uint8_t col_data = ~(1 << i);
		
		ByteDataWrite(col_data);
		ByteDataWrite(txt_play[(pattern_index + i) % (txt_playsize)]);

		_delay_us(500);
	}
	ByteDataWrite(0);
}

void slide_Data_Success(int pattern_index){
	for(int i = 0; i < 8; i++){
		uint8_t col_data = ~(1 << i);
		
		ByteDataWrite(col_data);
		ByteDataWrite(txt_success[(pattern_index + i) % (txt_successsize)]);

		_delay_us(500);
	}
	ByteDataWrite(0);
}

void slide_Data_Score(int pattern_index, uint8_t _eat_count){
	for(int i = 0; i < 8; i++){
		uint8_t col_data = ~(1 << i);
		
		ByteDataWrite(col_data);
		ByteDataWrite(txt_score[i+ (_eat_count * 8)]);

		_delay_us(500);
	}
	ByteDataWrite(0);
}

void display_Dot(uint8_t _col, uint8_t _row, uint8_t _f_col, uint8_t _f_row, uint8_t _head_Coord[][2], uint8_t _eat_count){
	uint8_t map_data[8] = {0,};
	
	map_data[_col] |= (1<<_row);
	map_data[_f_col] |= (1<<_f_row);
	for(int i = 0; i < _eat_count; i++){
		map_data[_head_Coord[i+1][0]] |= (1<<_head_Coord[i+1][1]);
	}
	for(int i = 0; i < 8; i++){
		uint8_t col_data = ~(1 << i);
		ByteDataWrite(col_data);
		ByteDataWrite(map_data[i % sizeof(map_data)]);
		_delay_ms(1);
	}
	ByteDataWrite(0);
}

void print_Data_Num(uint8_t num_index, uint8_t diff_num){
	for(int i = 0; i < 8; i++){
		uint8_t col_data = ~(1 << i);
		
		ByteDataWrite(col_data);
		ByteDataWrite(txt_num[i+(diff_num*8)]);
		_delay_us(400);
	}
	ByteDataWrite(0);
}